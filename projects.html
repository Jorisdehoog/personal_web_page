<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>JDEHOOG</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous"> -->
    <link rel="stylesheet" href="CSS/bootstrap.min.css">
    <link rel="stylesheet" href="CSS/bootstrap-select.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="CSS/footer.css">
    
    <style>
        
    </style>
</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
        <a class="navbar-brand" href="#">JDEHOOG</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item ">
                    <a class="nav-link" href="index.html">HOME <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="PDF/JORIS%20DE%20HOOG_V3.pdf">RESUME</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="about.html">ABOUT</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        PROJECTS
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item" href="projects.html">Climate Tracker</a>
                        <a class="dropdown-item disabled" href="#">Next Project</a>
                        <!--
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#">Something else here</a>
-->
                    </div>
                </li>
                <!--
                <li class="nav-item">
                    <a class="nav-link disabled" href="#">Disabled</a>
                </li>
-->
            </ul>
        </div>
    </nav>

    <div class="card mx-auto border-light">
        <div class="card-body">
            <h2 class="card-title text-center">Climate Tracker </h2>
            <p class="card-text"> Select a country from the list, and see for yourself the temperatures
                measured from roughly the beginning of the 20th century until the most recent measurements
                which are reported. This data comes courtesy of the <a href="https://datahelpdesk.worldbank.org/knowledgebase/articles/902061-climate-data-api" target="_blank">The World Bank
                    Climate data</a>. Default graph shown on this page shows the climatic results of Belgium. </p>
        </div>
    </div>

    <div class="card mx-auto border-light">
        <div class="card-body text-center">
            <h4 class="card-title">Choose a country from the list </h4>


            <!--            new select picker-->
            
            <select class="selectpicker" data-url="assets/countries_ISO_FIXED.json" data-id="ISO" data-label="Country" id="locality-dropdown" onchange="plotClimateData();" data-live-search="true" data-width="fit" dropdownAlignRight="true">
            </select>

            
<!--
            <div class="form-check">
                <input type="checkbox" autocomplete="off" class="form-check-input" id="selectFit" onclick=";">
                <label class="form-check-label" for="selectFit">Linear Regression</label>
            </div>
-->

        </div>
    </div>


    <!--- show datapoints --->
    <!-- <div class="chart-container" style="position: relative; height:75vh; width:90vw; display: block; margin: auto"> -->
    <div class="chart-container card mx-auto border-light">
        <canvas id="myChart"></canvas>
    </div>


    <!-- TO DO: 
    * Change the way we get the JSON's, try to use cURL instead if possible?  -->

    <div class="card mx-auto border-light">
        <div class="card-body">
            <h6 class="card-title">What's next? </h6>
            <p class="card-text"> This will be extended. I will add features such as
                a simple linear fit through the dataset, indicating the increase in average
                yearly temperatures. I will add min-max lines to the graph. A search function
                in the dropdown has to be implemented. Also, I would like to have the option to
                display multiple graphs on top of each other, so you can compare temperatures.
                Finally, this page needs some color! (And while I'm dreaming, some GMAPS integration
                showing the location of the selected country would be nice also)
            </p>
        </div>
    </div>



    <!--- footer thingy --->
    <div class="footer bg-dark" align="center">
        <div class="icon-bar">
            <a href="https://www.facebook.com/jorisdehoog" class="fa fa-facebook" target="_blank"></a>
            <a href="https://github.com/Jorisdehoog" class="fa fa-github" target="_blank"></a>
            <a href="http://steamcommunity.com/id/dubforsup" class="fa fa-steam" target="_blank"></a>
            <a href="https://www.linkedin.com/in/jorisdehoog/" class="fa fa-linkedin-square" target="_blank"></a>
            <a href="mailto:dehoogjoris@gmail.com" class="fa fa-envelope"></a>
        </div>
    </div>

    <!---
  linear regression behavior: when the checkbox is marked, fit the current data
  on the screen. When the selection changes, fit the new data.
  --->


    <!-- functional scripts -->
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <!--    <script src="js/i18n/defaults-en_US.min.js"></script>-->
    <script src="js/bootstrap.min.js"></script>



    <script src="js/Chart.bundle.js"></script>
    <script src="js/regression.js"></script>



    <!--
    <script type="text/javascript">
        $.fn.selectpicker.Constructor.BootstrapVersion = '4';
    </script>
-->


    <script>
        // make 2d data Array
        function createArray(length) {
            var arr = new Array(length || 0),
                i = length;

            if (arguments.length > 1) {
                var args = Array.prototype.slice.call(arguments, 1);
                while (i--) arr[length - 1 - i] = createArray.apply(this, args);
            }

            return arr;
        }


        // linear Regression
        // we need to get the data currently selected, and do linear regression
        function linearRegression(xdata, ydata) {
            data = createArray(xdata.length, 2)
            for (var i = 0; i < xdata.length; i++) {
                data[i][0] = xdata[i];
                data[i][1] = ydata[i];
            }
            const result = regression.linear(data);

            var linreg = result.points;
            // split result.points into ylabels and xlabels:
            labels_ext = [];
            data_ext = [];
            var i;
            for (i = 0; i < xdata.length; i++) {
                labels_ext.push(linreg[i][0]);
                data_ext.push(linreg[i][1]);
            };

            // return both
            return [labels_ext, data_ext];

        };
    </script>

    <!--    UNCOMMENT ONCE FIXED-->
    <script>
        // get the current value of the dropdown list (expected: ISO-code of country)
        function selectCountry() {
            d = document.getElementById("locality-dropdown").value;
            return d;
        }
    </script>

    <script>
        function loadJSONForPlot(name) {
            // construct a directory name
            json_file = "climateJSONS/" + name + ".json";

            // load the json file and send to Chart
            $.getJSON(json_file, function(json) {
                //plotClimateData(json);
                return json;
            });
        }
    </script>


    <script>
        // this script load the json asynchronously, and checks if the call is
        // completed.
        function ajax_get(url, callback) {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function() {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    //console.log('response text: ' + xmlhttp.responseText);
                    try {
                        var data = JSON.parse(xmlhttp.responseText);
                    } catch (err) {
                        console.log(err.message + ' in ' + xmlhttp.responseText);
                        return;
                    }
                    callback(data)
                }
            };
            xmlhttp.open("GET", url, true);
            xmlhttp.send();
        }
    </script>


    <script>
        // declare the plot outside the function so it's not redeclared
        // every time
        var canvas = document.getElementById("myChart").getContext("2d");
        var myLineChart = new Chart(canvas, {
            type: 'bar',
            data: {
                datasets: [{
                    // nothing
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });


        function plotClimateData() {
            // start by removing jsonfile if it exists:
            if (typeof jsonfile !== 'undefined') {
                delete jsonfile;
            };

            // get the ISO country name selected:
            countryName = selectCountry();
            // load the json file;
            //jsonfile = loadJSONForPlot(countryName);
            jsonFilePath = "climateJSONS/" + countryName + ".json";
            jsonfile = ajax_get(jsonFilePath, function(jsonfile) {
                //console.log(jsfile);
                //return data;

                window.chartColors = {
                    red: 'rgb(255, 99, 132)',
                    orange: 'rgb(255, 159, 64)',
                    yellow: 'rgb(255, 205, 86)',
                    green: 'rgb(75, 192, 192)',
                    blue: 'rgb(54, 162, 235)',
                    purple: 'rgb(153, 102, 255)',
                    grey: 'rgb(231,233,237)'
                };

                var labels_e = jsonfile.map(function(e) {
                    return e.year;
                });

                var data_e = jsonfile.map(function(e) {
                    return e.data;
                });


                var data = {
                    labels: labels_e,
                    datasets: [{
                        label: 'Average Temperature Measurements',
                        backgroundColor: window.chartColors.green,
                        data: data_e,
                    }]
                };

                if (myLineChart)
                    myLineChart.destroy();

                // this plots the original data
                myLineChart = new Chart(canvas, {
                    type: 'bar',
                    data: data,
                });

                // add lines for min and max
                data_e_max = Math.max.apply(null, data_e);
                data_e_min = Math.min.apply(null, data_e);
                // make linear array
                data_e_max_arr = createArray(labels_e.length)
                data_e_min_arr = createArray(labels_e.length)
                for (i = 0; i < data_e_max_arr.length; i++) {
                    data_e_max_arr[i] = data_e_max;
                    data_e_min_arr[i] = data_e_min;

                }
                //                console.log(data_e_max_arr);

                // add these things to the plot
                addDataToPlot(labels_e, data_e_max_arr, 'Maximum values', window.chartColors.red, false);
                addDataToPlot(labels_e, data_e_min_arr, 'Minimum values', window.chartColors.blue, false);
                myLineChart.update();

                // calculate the lin regression by default, and add this to the dataset
                var linRegData = linearRegression(labels_e, data_e);
                var data_ext = linRegData[1];
                var labels_ext = linRegData[0];
                // add this data to the plot
                addDataToPlot(labels_ext, data_ext, 'Linear Regression', window.chartColors.purple);

                // check if the checkbox is marked. If yes, use the addData function of ChartJS here?
//                d = document.getElementById("selectFit").checked;
//                if (d) {
//                    // change the hidden flag to false
//                    myLineChart.data.datasets[1].hidden = false;
//                    myLineChart.update();
//                }
                // also add live listener for clicking the button:
                $('input:checkbox').change(
                    function() {
                        if ($(this).is(':checked')) {
                            // set flag to false
                            myLineChart.data.datasets[3].hidden = false;
                            myLineChart.update();
                        } else {
                            // set flag to true
                            myLineChart.data.datasets[3].hidden = true;
                            myLineChart.update();
                        }
                    }
                );
            });
        }

        function addDataToPlot(labels_ext, data_ext, label_in, BC = window.chartColors.blue, hid = true) {
            var newDataSet = {
                label: label_in,
                type: 'line',
                borderColor: BC,
                backgroundColor: "rgba(0, 0, 0, 0)",
                radius: 0,
                data: data_ext,
                labels: labels_ext,
                hidden: hid,
            };
            myLineChart.data.datasets.push(newDataSet);
            myLineChart.update();
        }
    </script>

    <script>
        // remove data from the dataset
        function removeData(chart) {
            chart.data.datasets.splice(1, 1);
            chart.update();
        }
    </script>

    <!--
    <script>
        // populate dropdown from JSON file
        let dropdown = document.getElementById('locality-dropdown');
        dropdown.length = 0;

        // add a searchbox to the dropdown
//        let input = document.createElement('input');
//        input.type = "text";
//        input.className = "what";
//        dropdown.add(input);
//        dropdown.selectedIndex = 0;
        
        let defaultOption = document.createElement('option');
        defaultOption.text = 'Choose a Country';

        dropdown.add(defaultOption);
        dropdown.selectedIndex = 0;
        

        $.getJSON("countries_ISO.json", function(data) {
            for (let i = 0; i < data.length; i++) {
                option = document.createElement('option');
                option.text = data[i].Country;
                option.value = data[i].ISO;
                dropdown.add(option);
            }
        });
    </script>
-->

    <!--    make searchfunction-->
    <!--
    <script>
    function filterFunction(){
        var input, filter, ul, li, a, i;
        input = document.getElementById('locality-dropdown');
        
        
    }
    </script>
-->


    <script src="js/bootstrap-select.js"></script>




</body>

</html>